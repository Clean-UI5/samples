<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <title>Special Instructions</title>
    <script src="https://ui5.sap.com/resources/sap-ui-core.js"
      id="sap-ui-bootstrap"
      data-sap-ui-libs="sap.m,sap.ui.layout"
      data-sap-ui-theme="sap_fiori_3"
      data-sap-ui-async="true"
      data-sap-ui-compatVersion ="edge"
    ></script>
  </head>
  <body id="content" class="sapUiBody">
  </body>
  <script language="JavaScript">
sap.ui.require([
  'sap/ui/core/Fragment',
  'sap/ui/model/json/JSONModel'
], async function (Fragment, JSONModel) {

  function xfrag (xmlContent) {
    return Fragment.load({
      type: 'XML',
      definition: `
<core:FragmentDefinition
  xmlns:core="sap.ui.core"
>
  ${xmlContent}
</core:FragmentDefinition>`
    });
  }
  
  const view = await xfrag`
<mvc:View
  xmlns:mvc="sap.ui.core.mvc"
  xmlns:m="sap.m"
  xmlns:f="sap.ui.layout.form"
  xmlns:core="sap.ui.core"
>
  <mvc:content>
    <m:VBox
      class="sapUiLargeMargin"
    >
      <f:SimpleForm
        layout="ResponsiveGridLayout"
        labelSpanXL="3"
        labelSpanL="3"
        labelSpanM="3"
        labelSpanS="12"
        adjustLabelSpan="false"
        emptySpanXL="4"
        emptySpanL="4"
        emptySpanM="4"
        emptySpanS="0"
        columnsXL="1"
        columnsL="1"
        columnsM="1"
        singleContainerFullSize="false"  
      >
        <f:toolbar>
          <m:Toolbar>
            <m:Title text="Special Instructions" />
            <m:Button id="mount" text="Mount models" />
            <m:Button id="unmount" text="Unmount models" />
          </m:Toolbar>
        </f:toolbar>
        <f:content>
          <m:Label text="Special instruction required" />
          <m:CheckBox selected="{viewState>/siRequired}" />
          <m:Label text="Special instruction acknowledged" />
          <m:CheckBox selected="{viewState>/siAcknowledged}" />
        </f:content>
      </f:SimpleForm>
      <m:Button id="finalizeReview"
        enabled="{= !\${viewState>/siRequired} || !!\${specialInstruction} }"
        text="Finalize review"
      />
      <m:MessageStrip id="siContent"
        visible="{= \${viewState>/siRequired} &amp;&amp; !\${specialInstruction} }"
        text="These are the special instructions"
        type="Warning"
        showIcon="true"
      />
      <m:Button id="ackSI"
        visible="{= \${viewState>/siRequired} &amp;&amp; !\${specialInstruction} }"
        text="Acknowledge the special instructions"
      />
      <m:MessageStrip id="siAckInfo"
        visible="{= !!\${specialInstruction} }"
        text="Instructions acknowledged by User"
        showIcon="true"
      />
    </m:VBox>
  </mvc:content>
</mvc:View>
`;

  const defaultModel = new JSONModel({});

  const viewState = new JSONModel({
    siRequired: false,
    siAcknowledged: false
  });

  function simulateSpecialInstruction () {
    let specialInstruction;
    if (viewState.getProperty('/siAcknowledged')) {
      specialInstruction = {};
    } else {
      specialInstruction = null;
    }
    defaultModel.setProperty('/specialInstruction', specialInstruction);
  }

  viewState.attachPropertyChange(simulateSpecialInstruction);

  function mount () {
    view.setModel(defaultModel);
    view.bindElement('/')
    view.setModel(viewState, 'viewState');
  }

  function unmount () {
    view.setModel(new JSONModel({}));
    view.bindElement('/')
    view.setModel(new JSONModel({}), 'viewState');
  }

  const core = sap.ui.getCore();
  core.byId('mount').attachPress(mount);
  core.byId('unmount').attachPress(unmount);
  core.byId('ackSI').attachPress(() => {
    viewState.setProperty('/siAcknowledged', true);
    simulateSpecialInstruction();
  });
  
  mount();
  view.placeAt('content');
});
  </script>
</html>
